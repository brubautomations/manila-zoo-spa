<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manila Zoo | The Next Generation SPA</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        /* --- GLOBAL & SPA CORE STYLES --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        body {
            background-color: #faf9f6;
            overflow: hidden;
            color: #111;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
        }

        /* --- PREMIUM NAVBAR --- */
        .navbar {
            width: 100%;
            padding: 25px 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 2000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #e2e8f0;
            position: relative;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            color: #111;
            text-decoration: none;
            cursor: pointer;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .logo-leaf {
            color: #10b981;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-tab {
            color: #4a5568;
            text-decoration: none;
            font-size: 14px;
            font-weight: 800;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.3s;
            letter-spacing: 1px;
        }

        .nav-tab:hover,
        .nav-tab.active {
            color: #10b981;
        }

        .btn-ticket-tab {
            background: #10b981;
            color: #fff !important;
            padding: 12px 28px;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
            font-weight: 800;
        }

        /* --- SPA VIEW MANAGEMENT --- */
        .main-stage {
            flex: 1;
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .view-section {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            overflow-y: auto;
            overflow-x: hidden;
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- 1. HOME VIEW (Full Fidelity) --- */
        #view-home {
            padding: 0;
            background: #000;
        }

        .video-bg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            z-index: 1;
            object-fit: cover;
            opacity: 0.55;
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(5, 15, 10, 0.4) 0%, rgba(5, 15, 10, 0.9) 100%);
            z-index: 2;
        }

        .hero-content {
            position: relative;
            z-index: 10;
            color: #fff;
            max-width: 900px;
            padding: 120px 40px;
            text-align: center;
            margin: 0 auto;
        }

        .hero-subtitle {
            font-size: 16px;
            font-weight: 600;
            color: #10b981;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 20px;
        }

        .hero-title {
            font-size: 80px;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 30px;
            letter-spacing: -2px;
        }

        .hero-title span {
            color: transparent;
            -webkit-text-stroke: 2px #fff;
        }

        .hero-desc {
            font-size: 18px;
            color: #cbd5e1;
            max-width: 700px;
            line-height: 1.6;
            margin: 0 auto 40px;
            font-weight: 300;
        }

        .app-section {
            padding: 80px 10%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 80px;
            background: #faf9f6;
            width: 100%;
        }

        .phone-mockup {
            width: 260px;
            height: 530px;
            background: #fff;
            border-radius: 40px;
            border: 12px solid #111;
            box-shadow: 0 25px 50px rgba(16, 185, 129, 0.2);
            position: relative;
            overflow: hidden;
            transform: rotate(-5deg);
            flex-shrink: 0;
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
        }

        /* --- 2. ANIMALS VIEW (9 Full Cards) --- */
        .directory-header {
            padding: 100px 60px 40px;
            text-align: center;
        }

        .animal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 40px;
            padding: 0 60px 100px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .animal-card {
            background: #fff;
            border-radius: 24px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
            transition: 0.4s;
            display: flex;
            flex-direction: column;
        }

        .animal-card:hover {
            transform: translateY(-10px);
            border-color: #10b981;
        }

        .animal-img {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }

        .animal-data {
            padding: 30px;
            flex: 1;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: 15px;
        }

        .status-critical {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-endangered {
            background: rgba(249, 115, 22, 0.1);
            color: #f97316;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }

        .status-vulnerable {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* --- 3. MAP VIEW (3D Map) --- */
        #view-map {
            padding: 0;
            display: none;
            background: #050b07;
        }

        #view-map.active {
            display: flex;
        }

        .map-sidebar {
            width: 420px;
            background: #08120c;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 40px;
            overflow-y: auto;
            z-index: 10;
        }

        .zone-item {
            padding: 18px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: 0.3s;
            color: #fff;
        }

        .zone-item:hover {
            background: rgba(16, 185, 129, 0.1);
            transform: translateX(10px);
        }

        .map-area {
            flex: 1;
            background: #e8e3d9;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-wrapper {
            position: relative;
            height: 95%;
            aspect-ratio: 1.5;
            transition: 0.7s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .map-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
        }

        .pin {
            position: absolute;
            width: 22px;
            height: 22px;
            background: #10b981;
            border-radius: 50%;
            border: 3px solid #fff;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.9);
            transition: 0.3s;
            z-index: 5;
        }

        .pin::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 3px solid rgba(16, 185, 129, 0.7);
            border-radius: 50%;
            animation: ping 2s infinite;
        }

        @keyframes ping {

            75%,
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .pin:hover,
        .pin.active-pin {
            transform: scale(1.6);
            background: #fff;
            z-index: 10;
        }

        .map-popup {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 320px;
            background: rgba(5, 11, 7, 0.95);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 15px;
            display: none;
            z-index: 20;
            color: #fff;
            border: 1px solid rgba(16, 185, 129, 0.4);
        }

        /* Real Coords from Map.html */
        #pin-aviary {
            top: 21%;
            left: 45%;
        }

        #pin-savanna {
            top: 28%;
            left: 72%;
        }

        #pin-predators {
            top: 29%;
            left: 59.5%;
        }

        #pin-hippos {
            top: 34%;
            left: 40.5%;
        }

        #pin-primates {
            top: 40%;
            left: 26%;
        }

        #pin-elephants {
            top: 60%;
            left: 65%;
        }

        #pin-island {
            top: 52%;
            left: 49%;
        }

        #pin-reptiles {
            top: 31%;
            left: 23%;
        }

        /* --- 4. CONSERVATION (Leaves) --- */
        .falling-leaf {
            position: fixed;
            top: -50px;
            z-index: 1;
            pointer-events: none;
            animation: leafFall linear forwards, leafSway 3s ease-in-out infinite alternate;
            opacity: 0.6;
        }

        @keyframes leafFall {
            to {
                top: 110vh;
            }
        }

        @keyframes leafSway {
            from {
                transform: translateX(-30px) rotate(-15deg);
            }

            to {
                transform: translateX(30px) rotate(45deg);
            }
        }

        .mission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 40px;
            padding: 60px;
            position: relative;
            z-index: 10;
        }

        .mission-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
        }

        /* --- 5. TICKETS & PHYSICS --- */
        .ticket-page-container {
            display: flex;
            gap: 40px;
            padding: 60px;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        .ticket-ui-main {
            background: #fff;
            padding: 40px;
            border-radius: 24px;
            border: 1px solid #e2e8f0;
            flex: 1;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        .ticket-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #faf9f6;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
        }

        #animal-track {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100vw;
            height: 120px;
            z-index: 9000;
            pointer-events: none;
        }

        .zoo-pet {
            position: absolute;
            bottom: 10px;
            font-size: 65px;
            cursor: grab;
            pointer-events: auto;
            user-select: none;
            width: 85px;
            height: 85px;
            display: flex;
            justify-content: center;
            align-items: center;
            filter: drop-shadow(0 10px 10px rgba(0, 0, 0, 0.15));
        }

        .crying::after {
            content: 'üí¶';
            position: absolute;
            top: -15px;
            right: 0;
            font-size: 30px;
            animation: tearBounce 0.3s infinite alternate;
        }

        @keyframes tearBounce {
            from {
                transform: translateY(0);
            }

            to {
                transform: translateY(10px);
            }
        }

        .run-away {
            animation: sprintOff 0.8s ease-in forwards !important;
        }

        @keyframes sprintOff {
            to {
                left: 120vw;
                transform: skewX(-20deg) scale(1.1);
            }
        }

        /* --- MASKED PREMIUM AI BUTTON --- */
        #ai-ranger-btn {
            position: fixed;
            bottom: 40px;
            right: 40px;
            background: #10b981;
            color: #fff;
            padding: 20px 40px;
            border-radius: 60px;
            font-weight: 800;
            border: 2px solid #fff;
            cursor: pointer;
            z-index: 10001;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 15px 45px rgba(16, 185, 129, 0.6);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-size: 15px;
        }

        #ai-ranger-btn.active {
            background: #fff;
            color: #10b981;
            border-color: #10b981;
        }

        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
        }

        #ai-ranger-btn.active .pulse-dot {
            background: #10b981;
            animation: rangerPulse 1.5s infinite;
        }

        @keyframes rangerPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }

            70% {
                box-shadow: 0 0 0 20px rgba(16, 185, 129, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
    </style>
</head>

<body>

    <nav class="navbar">
        <div class="logo" onclick="switchTab('view-home')"><span class="logo-leaf">üåø</span> MANILA <span>ZOO</span>
        </div>
        <div class="nav-links">
            <div class="nav-tab" id="tab-animals" onclick="switchTab('view-animals')">Our Animals</div>
            <div class="nav-tab" id="tab-map" onclick="switchTab('view-map')">Interactive Map</div>
            <div class="nav-tab" id="tab-conservation" onclick="switchTab('view-conservation')">Conservation</div>
            <div class="nav-tab btn-ticket-tab" id="tab-tickets" onclick="switchTab('view-tickets')">Buy Tickets</div>
        </div>
    </nav>

    <main class="main-stage">

        <section id="view-home" class="view-section active">
            <video autoplay muted loop playsinline class="video-bg">
                <source src="bg_video.mp4" type="video/mp4">
            </video>
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <div class="hero-subtitle">The Iconic Landmark, Reborn</div>
                <h1 class="hero-title">Welcome to the New,<br><span>Manila Zoo.</span></h1>
                <p class="hero-desc">Experience world-class, glass-fronted habitats and our all-new AI smart park
                    features right in the heart of the city.</p>
                <button class="btn-ticket-tab" style="padding:22px 50px; font-size:16px; border:none;"
                    onclick="switchTab('view-tickets')">PLAN YOUR VISIT</button>
            </div>
            <div class="app-section">
                <div class="phone-mockup">
                    <div class="phone-screen">
                        <h3>MANILA ZOO</h3>
                        <p>SMART PARK APP</p>
                    </div>
                </div>
                <div style="max-width:550px;">
                    <h2 style="font-size:42px; font-weight:800; margin-bottom:20px;">Your Personal Park Ranger.</h2>
                    <p style="color:#4a5568; line-height:1.7; font-weight:600; margin-bottom:30px;">Navigate the park
                        like a pro. Get the official app for AI itineraries and feeding schedules.</p>
                    <img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg"
                        height="50">
                </div>
            </div>
        </section>

        <section id="view-animals" class="view-section">
            <div class="directory-header">
                <h1 style="font-size:54px; font-weight:800;">Wildlife Directory</h1>
                <p style="color:#4a5568; font-weight:600; margin-top:20px;">Explore the species that call Manila Zoo
                    home.</p>
            </div>
            <div class="animal-grid">
                <div class="animal-card"><img
                        src="https://upload.wikimedia.org/wikipedia/commons/c/c9/Philippine_Eagle_%28Pithecophaga_jefferyi%29.jpg"
                        class="animal-img">
                    <div class="animal-data">
                        <div class="status-badge status-critical">Critically Endangered</div>
                        <h3>Philippine Eagle</h3>
                    </div>
                </div>
                <div class="animal-card"><img
                        src="https://upload.wikimedia.org/wikipedia/commons/3/36/Tamaraw_Mindoro_Dwarf_Buffalo.jpg"
                        class="animal-img">
                    <div class="animal-data">
                        <div class="status-badge status-critical">Critically Endangered</div>
                        <h3>Tamaraw</h3>
                    </div>
                </div>
                <div class="animal-card"><img
                        src="https://upload.wikimedia.org/wikipedia/commons/8/82/Saltwater_Crocodile_at_Cairns.jpg"
                        class="animal-img">
                    <div class="animal-data">
                        <div class="status-badge status-vulnerable">Vulnerable</div>
                        <h3>Saltwater Crocodile</h3>
                    </div>
                </div>
                <div class="animal-card"><img
                        src="https://upload.wikimedia.org/wikipedia/commons/3/37/Asian_Elephant_in_a_dry_forest.jpg"
                        class="animal-img">
                    <div class="animal-data">
                        <div class="status-badge status-endangered">Endangered</div>
                        <h3>Asian Elephant</h3>
                    </div>
                </div>
                <div class="animal-card"><img
                        src="https://upload.wikimedia.org/wikipedia/commons/7/73/Lion_waiting_in_Namibia.jpg"
                        class="animal-img">
                    <div class="animal-data">
                        <div class="status-badge status-vulnerable">Vulnerable</div>
                        <h3>African Lion</h3>
                    </div>
                </div>
                <div class="animal-card"><img
                        src="https://upload.wikimedia.org/wikipedia/commons/9/9e/Giraffe_Mikumi_National_Park.jpg"
                        class="animal-img">
                    <div class="animal-data">
                        <div class="status-badge status-endangered">Endangered</div>
                        <h3>Reticulated Giraffe</h3>
                    </div>
                </div>
                <div class="animal-card"><img
                        src="https://upload.wikimedia.org/wikipedia/commons/8/8b/Zebras_Etosha.jpg" class="animal-img">
                    <div class="animal-data">
                        <div class="status-badge status-vulnerable">Vulnerable</div>
                        <h3>Plains Zebra</h3>
                    </div>
                </div>
                <div class="animal-card"><img
                        src="https://upload.wikimedia.org/wikipedia/commons/f/f2/Hippopotamus_amphibius_in_Tanzania.jpg"
                        class="animal-img">
                    <div class="animal-data">
                        <div class="status-badge status-vulnerable">Vulnerable</div>
                        <h3>Hippopotamus</h3>
                    </div>
                </div>
                <div class="animal-card"><img
                        src="https://upload.wikimedia.org/wikipedia/commons/c/c2/Crab-eating_macaque_-_Macaca_fascicularis.jpg"
                        class="animal-img">
                    <div class="animal-data">
                        <div class="status-badge status-endangered">Endangered</div>
                        <h3>Long-tailed Macaque</h3>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-map" class="view-section">
            <aside class="map-sidebar">
                <h2 style="color:#fff; font-size:26px; margin-bottom:30px;">Explore Zones</h2>
                <ul class="zone-list">
                    <li class="zone-item" onclick="showZone('aviary')">Zone 3: The Aviary</li>
                    <li class="zone-item" onclick="showZone('savanna')">Zone 5: Savanna</li>
                    <li class="zone-item" onclick="showZone('predators')">Zone 6: Predators</li>
                    <li class="zone-item" onclick="showZone('hippos')">Zone 2: Hippo Pools</li>
                    <li class="zone-item" onclick="showZone('primates')">Zone 14: Primates</li>
                    <li class="zone-item" onclick="showZone('elephants')">Zone 1: Elephants</li>
                </ul>
            </aside>
            <div class="map-area">
                <div class="map-wrapper" id="map-wrapper"><img src="map-3d.jpg" class="map-bg">
                    <div class="pin" id="pin-aviary" onclick="showZone('aviary')"></div>
                    <div class="pin" id="pin-savanna" onclick="showZone('savanna')"></div>
                    <div class="pin" id="pin-predators" onclick="showZone('predators')"></div>
                    <div class="pin" id="pin-hippos" onclick="showZone('hippos')"></div>
                    <div class="pin" id="pin-elephants" onclick="showZone('elephants')"></div>
                    <div class="pin" id="pin-primates" onclick="showZone('primates')"></div>
                    <div class="pin" id="pin-island" onclick="showZone('island')"></div>
                    <div class="pin" id="pin-reptiles" onclick="showZone('reptiles')"></div>
                </div>
                <div class="map-popup" id="info-popup">
                    <h3 id="pop-t"></h3>
                    <p id="pop-d" style="color:#cbd5e1; font-size:14px; margin-top:10px;"></p>
                </div>
            </div>
        </section>

        <section id="view-conservation" class="view-section">
            <div class="directory-header">
                <h1 style="font-size:54px; font-weight:800;">Protecting Tomorrow, <span>Today.</span></h1>
            </div>
            <div class="mission-grid">
                <div class="mission-card"><img
                        src="https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?q=80&w=800"
                        style="width:100%; height:250px; object-fit:cover;">
                    <div style="padding:30px;">
                        <h3>Urban Reforestation</h3>
                        <p>Transforming Manila Zoo into a carbon sink.</p>
                    </div>
                </div>
                <div class="mission-card"><img
                        src="https://images.unsplash.com/photo-1596401057633-54a8fe8ef647?q=80&w=800"
                        style="width:100%; height:250px; object-fit:cover;">
                    <div style="padding:30px;">
                        <h3>Species Breeding</h3>
                        <p>Saving the Tamaraw and Philippine Eagle.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-tickets" class="view-section">
            <div class="ticket-page-container">
                <div class="ticket-ui-main">
                    <h2 style="font-size:32px; font-weight:800; margin-bottom:30px;">Admission Tickets</h2>
                    <div class="ticket-item-row">
                        <div>
                            <h4>Adult</h4>
                            <p>13+ years</p>
                        </div>
                        <div style="font-size:24px; font-weight:800;">‚Ç±300</div>
                    </div>
                    <div class="ticket-item-row">
                        <div>
                            <h4>Child</h4>
                            <p>3-12 years</p>
                        </div>
                        <div style="font-size:24px; font-weight:800;">‚Ç±200</div>
                    </div>
                    <button class="btn-ticket-tab"
                        style="width:100%; border:none; padding:18px; margin-top:30px;">PROCEED TO CHECKOUT</button>
                </div>
                <div style="flex:1.2; background:#f4fdf8; padding:40px; border-radius:24px; border:2px solid #10b981;">
                    <div style="display:flex; align-items:center; gap:20px; margin-bottom:20px;">
                        <div
                            style="background:#10b981; color:#fff; width:45px; height:45px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:22px;">
                            ‚ú®</div>
                        <h3 style="margin:0;">AI Smart Planner</h3>
                    </div>
                    <textarea
                        style="width:100%; height:120px; border-radius:15px; border:2px solid #cbd5e1; padding:20px; font-size:16px; outline:none;"
                        placeholder="Describe your group..."></textarea>
                    <button class="btn-ticket-tab" style="float:right; border:none; margin-top:20px;"
                        onclick="generateSmartItinerary()">GENERATE ROUTE</button>
                    <div class="timeline" id="itinerary-timeline" style="clear:both; margin-top:40px;"></div>
                </div>
            </div>
            <div id="animal-track"></div>
        </section>
    </main>

    <button id="ai-ranger-btn">
        <div class="pulse-dot"></div> <span id="btn-text">Talk to AI Ranger</span>
    </button>

    <script type="module">
        import { Conversation } from 'https://cdn.jsdelivr.net/npm/@11labs/client/+esm';

        // 1. SPA LOGIC
        window.switchTab = function (tabId) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            const target = document.getElementById(tabId);
            if (target) target.classList.add('active');
            const tabMap = { 'view-animals': 'tab-animals', 'view-map': 'tab-map', 'view-conservation': 'tab-conservation', 'view-tickets': 'tab-tickets' };
            if (tabMap[tabId]) document.getElementById(tabMap[tabId]).classList.add('active');
            if (tabId === 'view-conservation') { if (!window.leafInterval) window.leafInterval = setInterval(spawnLeaf, 450); }
            else { clearInterval(window.leafInterval); window.leafInterval = null; }
        };

        // 2. MAP & POPUP LOGIC
        window.showZone = function (id) {
            const z = { 'aviary': { t: 'Zone 3: The Aviary', d: 'Philippine Eagles.' }, 'savanna': { t: 'Zone 5: Savanna', d: 'Zebras & Giraffes.' }, 'predators': { t: 'Zone 6: Predators', d: 'Lions.' }, 'hippos': { t: 'Zone 2: Hippo Pools', d: 'River horses.' }, 'elephants': { t: 'Zone 1: Elephants', d: 'Gentle giants.' } };
            if (!z[id]) return;
            document.getElementById('pop-t').innerText = z[id].t; document.getElementById('pop-d').innerText = z[id].d;
            document.getElementById('info-popup').style.display = 'block';
            document.getElementById('map-wrapper').style.transform = 'scale(1.05)';
            setTimeout(() => document.getElementById('map-wrapper').style.transform = 'scale(1)', 600);
            return "Updated UI";
        };

        // 3. WHITELABELED AI SDK (Continuous Session)
        let session = null; let isConnected = false;
        const btn = document.getElementById('ai-ranger-btn');
        btn.onclick = async () => {
            if (isConnected) { if (session) { await session.endSession(); session = null; } return; }
            document.getElementById('btn-text').innerText = "Connecting...";
            try {
                await navigator.mediaDevices.getUserMedia({ audio: true });
                session = await Conversation.startSession({
                    agentId: 'agent_4101kj9n39wqfv7v5ryfjav51mkv',
                    onConnect: () => { isConnected = true; btn.classList.add('active'); document.getElementById('btn-text').innerText = "Ranger is Live"; },
                    onDisconnect: () => { isConnected = false; btn.classList.remove('active'); document.getElementById('btn-text').innerText = "Talk to AI Ranger"; },
                    clientTools: {
                        Maps_tab: (p) => {
                            const map = { 'OUR ANIMALS': 'view-animals', 'INTERACTIVE MAP': 'view-map', 'CONSERVATION': 'view-conservation', 'BUY TICKETS': 'view-tickets' };
                            if (map[p.tab_name]) { switchTab(map[p.tab_name]); return "Success"; }
                        },
                        update_map: (p) => window.showZone(p.zone_id)
                    }
                });
            } catch (err) { alert("Mic required."); }
        };

        // 4. PHYSICS ENGINE & ANIMATIONS
        const aniArr = ['üêò', 'ü¶Å', 'ü¶í', 'ü¶ì', 'üêí', 'üê¢', 'ü¶õ', 'ü¶è'];
        function spawnPet() {
            const pet = document.createElement('div'); pet.className = 'zoo-pet'; pet.style.left = '-100px';
            pet.innerHTML = `<span class="flip-emoji">${aniArr[Math.floor(Math.random() * aniArr.length)]}</span>`;
            document.getElementById('animal-track').appendChild(pet);
            let pos = -100; let walk = setInterval(() => { if (pos > window.innerWidth) { clearInterval(walk); pet.remove(); } pos += 2.5; pet.style.left = pos + 'px'; }, 30);
            pet.onmousedown = (e) => {
                clearInterval(walk); pet.style.position = 'fixed';
                const mm = (m) => { pet.style.left = (m.clientX - 45) + 'px'; pet.style.top = (m.clientY - 45) + 'px'; };
                const mu = () => {
                    document.removeEventListener('mousemove', mm); document.removeEventListener('mouseup', mu);
                    pet.style.transition = 'top 0.4s ease-in'; pet.style.top = (window.innerHeight - 100) + 'px';
                    setTimeout(() => { pet.classList.add('crying'); setTimeout(() => { pet.classList.remove('crying'); pet.classList.add('run-away'); setTimeout(() => pet.remove(), 1000); }, 1200); }, 400);
                };
                document.addEventListener('mousemove', mm); document.addEventListener('mouseup', mu);
            };
        }
        setInterval(spawnPet, 4500);

        function spawnLeaf() {
            const leaf = document.createElement('div'); leaf.classList.add('falling-leaf'); leaf.innerText = 'üçÉ';
            leaf.style.left = Math.random() * 100 + 'vw'; leaf.style.fontSize = Math.random() * 20 + 20 + 'px';
            leaf.style.animationDuration = Math.random() * 3 + 5 + 's';
            document.body.appendChild(leaf); setTimeout(() => leaf.remove(), 8000);
        }

        window.generateSmartItinerary = () => {
            const tl = document.getElementById('itinerary-timeline');
            tl.innerHTML = '<div style="background:#fff; padding:20px; border-radius:12px; font-weight:600;">Generating optimal path...</div>';
            setTimeout(() => { tl.innerHTML = '<div class="time-slot"><h4>09:00 AM</h4><p>Zone 1: Elephants</p></div><div class="time-slot"><h4>10:30 AM</h4><p>Zone 6: Predators</p></div>'; }, 1500);
        };
    </script>
</body>

</html>